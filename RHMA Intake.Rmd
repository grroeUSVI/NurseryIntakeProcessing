---
title: "Red Mangrove Intake"
output: html_document
date: "2025-05-13"
editor_options: 
  chunk_output_type: console
---



```{r Load DF, Fix Data Class}
library(readr)

#load the dataframe
RHMA<- read_csv("Master Nursery Intake Data - RHMA Intake Data.csv")

#uploaded as tibble, changing to df
RHMA<-as.data.frame(RHMA)
RHMA$`Mass (g)`<-as.numeric(RHMA$`Mass (g)`)#reclassifying Mass
RHMA$`Width (mm)`<-as.numeric(RHMA$`Width (mm)`)#reclassify Width
RHMA$`total length (cm)`<-as.numeric(RHMA$`total length (cm)`)#reclassify length

#look a the structure
str(RHMA)

#look at the number of collection sites
unique(RHMA$`Collection Site`)

```

[1] "Oasis Cove"        "Compass Pt."       "Compass Point"    
 [4] "CP"                "Marina"            "AL"               
 [7] "BB-HB"             "SR_HB"             "PB"               
[10] "SR"                "AB"                "OC"               
[13] "SR - MARINA"       "SALT RIVER MARINA" "ALTONA"           
[16] "SRBB"              "BB"                "MB"               
[19] "STEER ECOTOURS"    "MAGENS BAY"        "N/A"              
[22] NA                  "perseverance"      "Perseverance"     
[25] "Range Cay"         "STEER"             "Annaberg"         
[28] "Salt River"        "Preserverance"     "Brewers"          
[31] "Perserverance"     "Vessup"            "Mandahl"          
[34] "VESSUP"            "Salt River Marine" "COMPASS POINT"    
[37] "OASIS COVE"        "MDL"               "VESSUP BAY"     
[40] "VBSP"  

We have a lot of sites that have different names for the same place, fixing
```{r Remove Unknown Sites, and Fix Misnamed Sites}
library(tidyverse)

#ask around the lab if people can ID these sites, we can add them back in 

#remove unknown sites
RHMA<-RHMA%>%
    filter(!(`Collection Site`=="NA"))%>%
  filter(!(`Collection Site`=="BB-HB"))%>%
  filter(!(`Collection Site`=="N/A"))%>%
  filter(!(`Collection Site`=="Marina"))%>%
  filter(!(`Collection Site`=="MDL"))
  
  
#rename all the collection sites
RHMA<-RHMA%>%
  mutate(`Collection Site`=recode(`Collection Site`,
    "OC"= "Oasis Cove",
    "OASIS COVE" = "Oasis Cove",
    "CP"= "Compass Point",
    "Compass Pt." = "Compass Point",
    "COMPASS POINT" ="Compass Point",
    "SR"= "Salt River",
    "SR - MARINA"= "Salt River",
    "SALT RIVER MARINA"= "Salt River",
    "Salt River Marine"= "Salt River",
    "SR_HB"= "Salt River",
    "SRBB"= "Salt River",
    "STEER ECOTOURS"= "STEER",
    "Range Cay"= "Brewers Bay",
    "BB"= "Brewers Bay",
    "Brewers"= "Brewers Bay",
    "perseverance"= "Perserverace Bay",
    "Preserverance"= "Perserverace Bay",
    "Perseverance"= "Perserverace Bay",
    "PB"= "Perserverace Bay",
    "Perserverance"= "Perserverace Bay",
    "VESSUP"= "Vessup Bay",
    "VBSP" = "Vessup Bay",
    "Vessup" = "Vessup Bay",
    "VESSUP BAY"= "Vessup Bay",
    "AB" = "Annabergh Bay",
     "Annaberg"  = "Annabergh Bay",
    "AB" = "Annabergh Bay",
     "MAGENS BAY" ="Magens Bay",
    "MB" ="Magens Bay",
    "AL"="Altona Lagoon",
    "ALTONA"="Altona Lagoon",
    "Mandahl" ="Mandahl Bay",
    ))


unique(RHMA$`Collection Site`)
```

 [1] "Oasis Cove"       "Compass Point"    "Altona Lagoon"    "Salt River"      
 [5] "Perserverace Bay" "Brewers Bay"      "Magens Bay"       "STEER"           
 [9] "Annabergh Bay"    "Vessup Bay"       "Mandahl Bay" 


```{r Total Number of Trees Planted Per Year}
library(lubridate)#helpful package for classifying dates/times in r

RHMA$`Collection Date`<-mdy(RHMA$`Collection Date`)#tell R that CollectionDate is a date

unique(RHMA$`Collection Date`)#what are the unique values

#remove the NA
RHMA<-RHMA%>%
  filter(!is.na(`Collection Date`))

#double check that NA is removed
unique(RHMA$`Collection Date`)

#use lubridate function to take the year out of the collection date, so we can group props by year
RHMA<-RHMA%>%
  mutate(CollectionYear=year(`Collection Date`))

#use lubridate function to take the year out of the collection date, so we can group props by year
RHMA<-RHMA%>%
  mutate(Month=month(`Collection Date`))

unique(RHMA$CollectionYear)

RHMA<-RHMA%>%
    filter(!(CollectionYear==2002))#the nursery did not exist in 2002, removing this

#want to know how many trees planted each year
YearCount<-RHMA%>% #dataframe, and then
  group_by(CollectionYear)%>% 
  summarise(count=n())

#plot the total number of trees planted each year
YearPlot<-YearCount%>%
 ggplot(aes(x=CollectionYear, y=count))+
  geom_col()

YearPlot

str(YearCount)
YearCount$CollectionYear<-as.factor(YearCount$CollectionYear)

yearcolors<-c("darkolivegreen3", "tan4","darkgreen","tomato4","orange")

#making plot pretty
YearPlot<-YearCount%>%
  ggplot(aes(x=CollectionYear,y=count, color=CollectionYear, fill=CollectionYear))+
  geom_col(position="dodge", width=0.7)+#position=dodge, makes it so bars are next to each other
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+#this makes the x axis labels on an angle
  scale_fill_manual(values=yearcolors)+#makes the 
  scale_color_manual(values=yearcolors)+
  xlab("Collection Year")+
  ylab("Number of Propagules Planted")

YearPlot

```


```{r}

library(ggforce)
#look at how many in each site in each year

SiteCount<-RHMA%>%
  group_by(CollectionYear,`Collection Site`)%>%
  summarise(count=n())

#make year a factor so can use as categorical variable in bar plot
SiteCount$CollectionYear<-as.factor(SiteCount$CollectionYear)

#plot!
YearPlot<-SiteCount%>%
  ggplot(aes(x=`Collection Site`,y=count, color=CollectionYear, fill=CollectionYear))+
  geom_col(position="dodge", width=0.7)+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_fill_manual(values=yearcolors)+
  scale_color_manual(values=yearcolors)+
  xlab("Collection Site")+
  ylab("Number of Propagules Planted")


YearPlot

```


We have only data from all 5 years from compass, oasis, and steer so want to compare mass for these two sites

is there a significant difference in mass of props collected between these two sites in 2021?
```{r Compare Compass Point and Oasis Cove}
#filter for 2021 Only looking at compass point, oasis cove and steer
Compare<-RHMA%>%
  filter(CollectionYear=="2021")%>%
  filter(`Collection Site`=="Compass Point"|`Collection Site`=="Oasis Cove"|`Collection Site`=="STEER")%>%
  ggplot(aes(x=`Collection Site`, y=`Mass (g)`))+
  geom_violin()+
  geom_sina()+
  geom_boxplot(width=0.1, color="black", alpha=0.5)

Compare

#too few samples in steer not going to include them

#remade compare dataframe, and plotted again
Compare<-RHMA%>%
  filter(CollectionYear=="2021")%>%
  filter(`Collection Site`=="Compass Point"|`Collection Site`=="Oasis Cove")%>%
  ggplot(aes(x=`Collection Site`, y=`Mass (g)`))+
  geom_violin()+
  geom_sina()+
  geom_boxplot(width=0.1, color="black", alpha=0.5)

Compare

#filter so only have compass point
CompassPt<-RHMA%>%
  filter(CollectionYear=="2021")%>%
  filter(`Collection Site`=="Compass Point")%>%
  select(`Mass (g)`)

#what is the mean mass at compass point, want to add this to the plot because box plots show median
mean(CompassPt$`Mass (g)`)

#filter oasis cove
OasisCove<-RHMA%>%
  filter(CollectionYear=="2021")%>%
  filter(`Collection Site`=="Oasis Cove")%>%
  select(`Mass (g)`)
#mean at oasis cove
mean(OasisCove$`Mass (g)`)

#run T test to see if they are different
t.test(CompassPt, OasisCove)
```



```{r}
#look at size of props across different years
RHMA$CollectionYear<-as.factor(RHMA$CollectionYear)

#remove outlier
RHMA<-RHMA%>%
  filter(!(`Mass (g)`==1083.00))

#look at compass point
Site<-RHMA%>%
  filter(`Collection Site`=="Compass Point")%>%
  ggplot(aes(x=CollectionYear, y=`Mass (g)`))+
  geom_violin()+
  geom_sina()+
  geom_boxplot(width=0.1, color="black", alpha=0.5)

Site

#look at oasis cove
Site2<-RHMA%>%
  filter(`Collection Site`=="Oasis Cove")%>%
  ggplot(aes(x=CollectionYear, y=`Mass (g)`))+
  geom_violin()+
  geom_sina()+
  geom_boxplot(width=0.1, color="black", alpha=0.5)

Site2

#look at this
```


```{r}
#load Libraries
library(FSA)#for DunnPost Hoc
library(rcompanion)#for cldList function

#compass point

#looking at number planted each year
NumCollected<-RHMA%>%
   filter(`Collection Site`=="Compass Point")%>%
  group_by(CollectionYear)%>%
  summarise("numplanted"=n())

#only found 12 in 2022, filtering to remove 2022 

RHMA<-RHMA%>%
  filter(!(CollectionYear=="2022"& `Collection Site`=="Compass Point"))


#plot agian

Site<-RHMA%>%
  filter(`Collection Site`=="Compass Point")%>%
  ggplot(aes(x=CollectionYear, y=`Mass (g)`))+
  geom_violin()+
  geom_sina()+
  geom_boxplot(width=0.1, color="black", alpha=0.5)+
  ggtitle("Compass Point")

Site

#filter dataframe
CP<-RHMA%>%
  filter(`Collection Site`=="Compass Point")%>%
  filter(!(CollectionYear=="2022"))

#ready to run ANOVA!
#check assumptions

#equal variance

#equal variance, bartlet test
bartlett.test(CP$`Mass (g)`~CP$CollectionYear, CP)

#Bartlett test of homogeneity of variances

#data:  CP$`Mass (g)` by CP$CollectionYear
#Bartlett's K-squared = 153.42, df = 3, p-value < 2.2e-16

#dont meet assumptions run nonparametric

kruskal.test(CP$`Mass (g)`~CP$CollectionYear, data=CP)


#Kruskal-Wallis rank sum test

#data:  CP$`Mass (g)` by CP$CollectionYear
#Kruskal-Wallis chi-squared = 100.22, df = 3, p-value < 2.2e-16


CPDunn=dunnTest(CP$`Mass (g)` ~ CP$CollectionYear, data = CP)
CPDunn

#   Comparison         Z      P.unadj        P.adj
#1 2021 - 2023 1.9128729 5.576432e-02 1.115286e-01
#2 2021 - 2024 2.3743149 1.758155e-02 5.274464e-02
#3 2023 - 2024 0.4726529 6.364609e-01 6.364609e-01
#4 2021 - 2025 9.0027781 2.200769e-19 1.320461e-18
#5 2023 - 2025 6.7833735 1.174016e-11 5.870078e-11
#6 2024 - 2025 6.1874409 6.114876e-10 2.445950e-09


Lab1 = CPDunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)


#  Group Letter MonoLetter
#1   221      a         a 
#2   223      a         a 
#3   224      a         a 
#4   225      b          b




#look at oasis cove


Site1<-RHMA%>%
  filter(`Collection Site`=="Oasis Cove")%>%
  ggplot(aes(x=CollectionYear, y=`Mass (g)`))+
  geom_violin()+
  geom_sina()+
  geom_boxplot(width=0.1, color="black", alpha=0.5)+
  ggtitle("Oasis Cove")+
  ylab("Mass of Propagule (g)")#manually set the y axis 

Site1

view(Site1)

NumCollected<-RHMA%>%
   filter(`Collection Site`=="Oasis Cove")%>%
  group_by(CollectionYear)%>%
  summarise("numplanted"=n())

OA<-RHMA%>%
  filter(`Collection Site`=="Oasis Cove")

bartlett.test(OA$`Mass (g)`~ OA$CollectionYear, OA)

kruskal.test(OA$`Mass (g)`~OA$CollectionYear, data=OA)

#Kruskal-Wallis rank sum test

#data:  OA$`Mass (g)` by OA$CollectionYear
#Kruskal-Wallis chi-squared = 284.45, df = 4, p-value < 2.2e-16

CPDunn=dunnTest(OA$`Mass (g)` ~ OA$CollectionYear, data = OA)
CPDunn

#Comparison           Z      P.unadj        P.adj
#1  2021 - 2022  -4.5741684 4.781151e-06 1.912460e-05
#2  2021 - 2023  -5.2299810 1.695274e-07 8.476372e-07
#3  2022 - 2023   0.6798302 4.966120e-01 4.966120e-01
#4  2021 - 2024 -14.0243711 1.105882e-44 1.105882e-43
#5  2022 - 2024  -4.5363343 5.724041e-06 1.717212e-05
#6  2023 - 2024  -7.3709041 1.694748e-13 1.355798e-12
#7  2021 - 2025   3.9670956 7.275380e-05 1.455076e-04
#8  2022 - 2025   6.7891974 1.127591e-11 6.765544e-11
#9  2023 - 2025   7.2684395 3.636639e-13 2.545647e-12
#10 2024 - 2025  12.4189163 2.063376e-35 1.857038e-34


Lab2 = CPDunn$res

cldList(comparison = Lab2$Comparison,
        p.value    = Lab2$P.adj,
        threshold  = 0.05)
 #Group Letter MonoLetter
#1   221      a       a   
#2   222      b        b  
#3   223      b        b  
#4   224      c         c 
#5   225      d          d
```


```{r}

#look at number collected in different months

MonthYearCP<-RHMA%>%
  filter(`Collection Site`=="Compass Point")%>%
  group_by(CollectionYear, Month)%>%
  summarise("NumPlanted"=n())

MonthYearOC<-RHMA%>%
  filter(`Collection Site`=="Oasis Cove")%>%
  group_by(CollectionYear, Month)%>%
  summarise("NumPlanted"=n())



```

